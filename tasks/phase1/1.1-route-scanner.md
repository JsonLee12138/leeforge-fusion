# ä»»åŠ¡ 1.1: è·¯ç”±æ‰«æå™¨

## åŸºæœ¬ä¿¡æ¯

- **ä»»åŠ¡ç¼–å·**: 1.1
- **Phase**: 1 - æ ¸å¿ƒè·¯ç”±ç³»ç»Ÿ
- **è´Ÿè´£äºº**: èµ„æ·±æ¶æ„å¸ˆ
- **é¢„è®¡å·¥æ—¶**: 2 å¤©
- **ä¼˜å…ˆçº§**: ğŸ”´ P0
- **ä¾èµ–**: æ— 

## ä»»åŠ¡æè¿°

å®ç°è·¯ç”±æ‰«æå™¨ï¼Œç”¨äºæ‰«æ `app/` ç›®å½•å¹¶ç”Ÿæˆè·¯ç”±æ ‘ç»“æ„ã€‚è¿™æ˜¯æ•´ä¸ªæ¡†æ¶çš„åŸºç¡€ï¼Œæ‰€æœ‰è·¯ç”±åŠŸèƒ½éƒ½ä¾èµ–äºæ­¤ã€‚

## äº¤ä»˜ç‰©

### 1. æ ¸å¿ƒæ–‡ä»¶

- `packages/framework/src/router/scanner.ts` - è·¯ç”±æ‰«æå™¨ä¸»ç±»
- `packages/framework/src/router/types.ts` - è·¯ç”±ç±»å‹å®šä¹‰
- `packages/framework/src/router/utils.ts` - è·¯ç”±å·¥å…·å‡½æ•°

### 2. åŠŸèƒ½è¦æ±‚

- [ ] æ‰«æ app/ ç›®å½•
- [ ] è¯†åˆ«é¡µé¢æ–‡ä»¶ (page.tsx)
- [ ] è¯†åˆ«æœåŠ¡ç«¯ç»„ä»¶ (page.server.tsx)
- [ ] è¯†åˆ«å¸ƒå±€æ–‡ä»¶ (layout.tsx)
- [ ] è¯†åˆ« API è·¯ç”± (route.ts)
- [ ] è§£æåŠ¨æ€è·¯ç”± `[id]`
- [ ] æ”¯æŒè·¯ç”±ç»„ `(dashboard)`
- [ ] ç”Ÿæˆè·¯ç”±æ ‘ç»“æ„
- [ ] è·¯ç”±å»é‡å’Œå†²çªæ£€æµ‹

### 3. æµ‹è¯•è¦æ±‚

- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%
- [ ] æµ‹è¯•å„ç§è·¯ç”±æ¨¡å¼
- [ ] æµ‹è¯•è¾¹ç•Œæƒ…å†µ

## æŠ€æœ¯è¦æ±‚

### è¾“å…¥

```typescript
// app/ ç›®å½•ç»“æ„
app/
â”œâ”€â”€ page.tsx
â”œâ”€â”€ layout.tsx
â”œâ”€â”€ posts/
â”‚   â”œâ”€â”€ page.tsx
â”‚   â””â”€â”€ [postId]/
â”‚       â””â”€â”€ page.tsx
â”œâ”€â”€ (dashboard)/
â”‚   â”œâ”€â”€ page.tsx
â”‚   â””â”€â”€ layout.tsx
â””â”€â”€ api/
    â””â”€â”€ posts/
        â””â”€â”€ route.ts
```

### è¾“å‡º

```typescript
// è·¯ç”±æ ‘ç»“æ„
{
  path: '/',
  file: 'app/layout.tsx',
  type: 'layout',
  children: [
    {
      path: '/',
      file: 'app/page.tsx',
      type: 'page',
      params: []
    },
    {
      path: '/posts',
      file: 'app/posts/page.tsx',
      type: 'page',
      params: []
    },
    {
      path: '/posts/:postId',
      file: 'app/posts/[postId]/page.tsx',
      type: 'page',
      params: ['postId']
    },
    {
      path: '/dashboard',
      file: 'app/(dashboard)/layout.tsx',
      type: 'layout',
      children: [...]
    }
  ]
}
```

## å®ç°æ€è·¯

```typescript
// packages/framework/src/router/scanner.ts
import { glob } from "glob";
import { join } from "path";

export interface Route {
  path: string;
  file: string;
  type: "page" | "layout" | "api" | "server";
  params: string[];
  children?: Route[];
}

export class RouteScanner {
  private appDir: string;

  constructor(appDir: string) {
    this.appDir = appDir;
  }

  async scan(): Promise<Route[]> {
    // 1. æŸ¥æ‰¾æ‰€æœ‰ç›¸å…³æ–‡ä»¶
    const files = await this.findFiles();

    // 2. æ„å»ºè·¯ç”±æ ‘
    const routes = this.buildRouteTree(files);

    // 3. éªŒè¯è·¯ç”±
    this.validateRoutes(routes);

    return routes;
  }

  private async findFiles(): Promise<string[]> {
    return await glob(
      `${this.appDir}/**/{page,layout,route,page.server}.{tsx,ts,jsx,js}`,
    );
  }

  private buildRouteTree(files: string[]): Route[] {
    // å®ç°è·¯ç”±æ ‘æ„å»ºé€»è¾‘
  }

  private validateRoutes(routes: Route[]): void {
    // æ£€æŸ¥è·¯ç”±å†²çª
  }
}
```

## æµ‹è¯•ç”¨ä¾‹

```typescript
// tests/unit/router/scanner.test.ts
describe("RouteScanner", () => {
  test("scans basic routes", async () => {
    const scanner = new RouteScanner("./fixtures/app");
    const routes = await scanner.scan();

    expect(routes).toContainEqual({
      path: "/",
      file: "./fixtures/app/page.tsx",
      type: "page",
      params: [],
    });
  });

  test("handles dynamic routes", async () => {
    // æµ‹è¯• [id] è§£æ
  });

  test("handles route groups", async () => {
    // æµ‹è¯• (dashboard) è§£æ
  });
});
```

## éªŒæ”¶æ ‡å‡†

- [ ] å¯ä»¥æ­£ç¡®æ‰«ææ‰€æœ‰è·¯ç”±æ–‡ä»¶
- [ ] åŠ¨æ€è·¯ç”±å‚æ•°æ­£ç¡®è§£æ
- [ ] è·¯ç”±ç»„æ­£ç¡®å¤„ç†
- [ ] æ— è·¯ç”±å†²çª
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] ç±»å‹å®šä¹‰å®Œæ•´

## ç›¸å…³æ–‡æ¡£

- [è·¯ç”±ç³»ç»Ÿè®¾è®¡](../design-doc.md#1-è·¯ç”±ç³»ç»Ÿ)
- [æ–‡ä»¶çº¦å®š](../design-doc.md#è·¯ç”±çº¦å®š)

## æ³¨æ„äº‹é¡¹

1. è·¯å¾„å¤„ç†ä½¿ç”¨ POSIX æ ‡å‡†
2. è€ƒè™‘ Windows/Linux è·¯å¾„å·®å¼‚
3. ç¼“å­˜æ‰«æç»“æœä»¥æå‡æ€§èƒ½
4. æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
5. æ”¯æŒçƒ­é‡è½½æ—¶çš„å¢é‡æ›´æ–°

---

**åˆ›å»ºæ—¶é—´**: 2026-01-15  
**æœ€åæ›´æ–°**: 2026-01-15  
**çŠ¶æ€**: å¾…å¼€å§‹
